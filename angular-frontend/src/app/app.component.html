<!-- Main Toolbar -->
<mat-toolbar color="primary" class="main-toolbar">
  <mat-icon class="toolbar-icon">psychology</mat-icon>
  <span class="toolbar-title">{{ title }}</span>
  <span class="spacer"></span>
  
  <!-- Status indicators -->
  <div class="status-indicators">
    <mat-icon [class]="isConnected ? 'status-connected' : 'status-disconnected'">
      {{ isConnected ? 'wifi' : 'wifi_off' }}
    </mat-icon>
    <span class="status-text">
      {{ availableModels.length }} models available
    </span>
  </div>
  
  <!-- GitHub link -->
  <button mat-icon-button (click)="openGitHub()" matTooltip="View on GitHub">
    <mat-icon>code</mat-icon>
  </button>
</mat-toolbar>

<!-- Progress Bar -->
<mat-progress-bar 
  *ngIf="isProcessing" 
  mode="determinate" 
  [value]="currentProgress"
  class="progress-bar">
</mat-progress-bar>

<!-- Main Content Container -->
<div class="app-container">
  
  <!-- Welcome Section (shown when no models or not ready) -->
  <div *ngIf="!isConnected || availableModels.length === 0" class="welcome-section">
    <mat-card class="welcome-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon class="welcome-icon">psychology</mat-icon>
          Welcome to AI Model Comparison
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p *ngIf="!isConnected" class="welcome-message">
          <mat-icon color="warn">warning</mat-icon>
          Connecting to server... Please ensure the backend is running.
        </p>
        <p *ngIf="isConnected && availableModels.length === 0" class="welcome-message">
          <mat-icon color="warn">warning</mat-icon>
          No AI models found. Please ensure Ollama is running with installed models.
        </p>
        <div class="setup-instructions">
          <h3>Quick Setup:</h3>
          <ol>
            <li>Install and start Ollama</li>
            <li>Pull some models: <code>ollama pull llama3</code></li>
            <li>Start the backend: <code>python main.py</code></li>
            <li>Refresh this page</li>
          </ol>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Processing Controls -->
  <app-processing-controls
    *ngIf="isConnected && availableModels.length > 0"
    [isProcessing]="isProcessing"
    [isConnected]="isConnected"
    [availableModels]="availableModels.length"
    (questionSubmit)="onQuestionSubmit($event)"
    (stopProcessing)="onStopProcessing()"
    (refreshModels)="onRefreshModels()">
  </app-processing-controls>

  <!-- Status Message -->
  <div *ngIf="isProcessing || modelCards.length > 0" class="status-section">
    <mat-card class="status-card">
      <mat-card-content>
        <div class="status-content">
          <mat-icon class="status-icon" [class.spinning]="isProcessing">
            {{ isProcessing ? 'sync' : 'check_circle' }}
          </mat-icon>
          <div class="status-info">
            <h3>{{ statusMessage }}</h3>
            <p *ngIf="modelCards.length > 0">
              Completed: {{ getCompletedCount() }}/{{ modelCards.length }} models
              <span *ngIf="getErrorCount() > 0" class="error-count">
                ({{ getErrorCount() }} errors)
              </span>
            </p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Model Response Cards -->
  <div *ngIf="modelCards.length > 0" class="models-section">
    <div class="models-grid">
      <app-model-card
        *ngFor="let card of modelCards; trackBy: trackByModelName"
        [modelCard]="card">
      </app-model-card>
    </div>
  </div>

  <!-- Summary Section -->
  <div *ngIf="summary" class="summary-section">
    <mat-card class="summary-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>summarize</mat-icon>
          Comprehensive AI Analysis Report
        </mat-card-title>
        <mat-card-subtitle>
          Generated by {{ summary.bestModel }} â€¢ {{ summary.detailedReport.executionTime }}ms analysis time
        </mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <!-- Executive Summary Stats -->
        <div class="summary-stats">
          <div class="stat-item">
            <mat-icon>analytics</mat-icon>
            <div>
              <strong>{{ summary.completedModels }}</strong>
              <span>of {{ summary.totalModels }} models completed</span>
            </div>
          </div>
          <div class="stat-item">
            <mat-icon>star</mat-icon>
            <div>
              <strong>{{ summary.bestModel }}</strong>
              <span>top performing model</span>
            </div>
          </div>
          <div class="stat-item">
            <mat-icon>text_fields</mat-icon>
            <div>
              <strong>{{ summary.detailedReport.averageResponseLength }}</strong>
              <span>avg words per response</span>
            </div>
          </div>
        </div>

        <mat-divider></mat-divider>

        <!-- AI Expert Analysis -->
        <div class="analysis-section">
          <h3>
            <mat-icon>psychology</mat-icon>
            Expert AI Analysis
          </h3>
          <div class="analysis-content">
            <pre>{{ summary.analysis }}</pre>
          </div>
        </div>

        <mat-divider></mat-divider>

        <!-- Performance Ranking -->
        <div class="performance-section">
          <h3>
            <mat-icon>leaderboard</mat-icon>
            Model Performance Ranking
          </h3>
          <div class="ranking-list">
            <div *ngFor="let model of summary.detailedReport.modelPerformanceRanking; let i = index" 
                 class="ranking-item" [class.top-performer]="i === 0">
              <div class="rank-badge">{{ i + 1 }}</div>
              <div class="model-info">
                <div class="model-name">{{ model.modelName }}</div>
                <div class="model-metrics">
                  <span class="score">Score: {{ model.score }}/10</span>
                  <span class="word-count">{{ model.wordCount }} words</span>
                </div>
                <div class="quality-metrics">
                  <div class="metric">
                    <span>Completeness:</span>
                    <div class="metric-bar">
                      <div class="metric-fill" [style.width.%]="model.qualityMetrics.completeness * 10"></div>
                    </div>
                    <span>{{ model.qualityMetrics.completeness.toFixed(1) }}</span>
                  </div>
                  <div class="metric">
                    <span>Relevance:</span>
                    <div class="metric-bar">
                      <div class="metric-fill" [style.width.%]="model.qualityMetrics.relevance * 10"></div>
                    </div>
                    <span>{{ model.qualityMetrics.relevance.toFixed(1) }}</span>
                  </div>
                  <div class="metric">
                    <span>Clarity:</span>
                    <div class="metric-bar">
                      <div class="metric-fill" [style.width.%]="model.qualityMetrics.clarity * 10"></div>
                    </div>
                    <span>{{ model.qualityMetrics.clarity.toFixed(1) }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <mat-divider></mat-divider>

        <!-- Key Insights -->
        <div class="insights-section">
          <h3>
            <mat-icon>insights</mat-icon>
            Key Insights
          </h3>
          <ul class="insights-list">
            <li *ngFor="let insight of summary.detailedReport.topInsights">
              <mat-icon>trending_up</mat-icon>
              {{ insight }}
            </li>
          </ul>
        </div>

        <mat-divider></mat-divider>

        <!-- Model Comparison Matrix -->
        <div class="comparison-section">
          <h3>
            <mat-icon>compare</mat-icon>
            Detailed Model Comparison
          </h3>
          <div class="comparison-grid">
            <div *ngFor="let model of summary.detailedReport.comparisonMatrix" class="comparison-card">
              <h4>{{ model.modelName }}</h4>
              
              <div class="strengths">
                <h5><mat-icon>thumb_up</mat-icon> Strengths</h5>
                <ul>
                  <li *ngFor="let strength of model.strengths">{{ strength }}</li>
                </ul>
              </div>
              
              <div class="weaknesses">
                <h5><mat-icon>thumb_down</mat-icon> Areas for Improvement</h5>
                <ul>
                  <li *ngFor="let weakness of model.weaknesses">{{ weakness }}</li>
                </ul>
              </div>
              
              <div class="use-case">
                <h5><mat-icon>lightbulb</mat-icon> Best Use Case</h5>
                <p>{{ model.bestUseCase }}</p>
              </div>
            </div>
          </div>
        </div>

        <mat-divider></mat-divider>

        <!-- Recommendations -->
        <div class="recommendations-section">
          <h3>
            <mat-icon>recommend</mat-icon>
            Expert Recommendations
          </h3>
          <ul class="recommendations-list">
            <li *ngFor="let rec of summary.recommendations">
              <mat-icon>arrow_right</mat-icon>
              {{ rec }}
            </li>
          </ul>
        </div>
      </mat-card-content>

      <mat-card-actions>
        <button mat-raised-button color="primary" (click)="copySummary()">
          <mat-icon>content_copy</mat-icon>
          Copy Full Report
        </button>
        <button mat-button color="accent" (click)="downloadSummary()">
          <mat-icon>download</mat-icon>
          Download Detailed Report
        </button>
        <button mat-button (click)="exportToJson()">
          <mat-icon>code</mat-icon>
          Export JSON
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- Footer -->
  <div class="footer">
    <p>
      <mat-icon>code</mat-icon>
      Built with Angular & FastAPI â€¢ 
      <a href="#" (click)="openGitHub()">View Source</a>
    </p>
  </div>
</div>